<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Relatorio do Professor - <%= @teacher.name %></title>
  <%= @styles %>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <div>
        <div class="logo">
          <div class="logo-icon">H</div>
          <span>Hellen AI</span>
        </div>
        <h1><%= @teacher.name || "Professor" %></h1>
        <p class="subtitle">Relatorio de Performance - <%= @period %></p>
      </div>
      <div class="meta">
        <%= if @institution do %>
          <p><strong><%= @institution.name %></strong></p>
        <% end %>
        <p><%= @teacher.email %></p>
        <p>Gerado em: <%= @h.format_datetime(@generated_at) %></p>
      </div>
    </div>
  </div>

  <!-- Stats Section -->
  <div class="section">
    <h2 class="section-title">Resumo do Periodo</h2>
    <div class="stats-grid">
      <div class="stat-card">
        <h3><%= @stats.lessons %></h3>
        <p>Aulas</p>
      </div>
      <div class="stat-card">
        <h3><%= @stats.analyses %></h3>
        <p>Analises</p>
      </div>
      <%= if @stats.avg_score do %>
        <div class="stat-card highlight">
          <h3><%= @stats.avg_score %>/10</h3>
          <p>Score Medio</p>
        </div>
      <% end %>
      <div class="stat-card">
        <span class="<%= @h.trend_class(@stats.trend) %>">
          <%= @h.trend_label(@stats.trend) %>
        </span>
        <p>Tendencia</p>
      </div>
    </div>
  </div>

  <!-- Score History -->
  <%= if length(@score_history) > 0 do %>
    <div class="section">
      <h2 class="section-title">Historico de Scores</h2>
      <table>
        <thead>
          <tr>
            <th>Data</th>
            <th>Aula</th>
            <th class="text-center">Score</th>
          </tr>
        </thead>
        <tbody>
          <%= for item <- @score_history do %>
            <tr>
              <td><%= @h.format_date(item.date) %></td>
              <td><%= @h.truncate(item.lesson_title || "Aula", 45) %></td>
              <td class="text-center">
                <span class="<%= @h.score_class(item.score) %>">
                  <%= item.score %>/10
                </span>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>

  <!-- Two Column: Lessons & BNCC -->
  <div class="section">
    <div class="two-column">
      <!-- Recent Lessons -->
      <div>
        <h2 class="section-title">Aulas Recentes</h2>
        <%= if length(@recent_lessons) > 0 do %>
          <table>
            <thead>
              <tr>
                <th>Titulo</th>
                <th class="text-center">Status</th>
                <th class="text-center">Score</th>
              </tr>
            </thead>
            <tbody>
              <%= for lesson <- @recent_lessons do %>
                <tr>
                  <td><%= @h.truncate(lesson.title, 28) %></td>
                  <td class="text-center">
                    <span class="badge <%= @h.status_badge_class(lesson.status) %>">
                      <%= @h.status_label(lesson.status) %>
                    </span>
                  </td>
                  <td class="text-center">
                    <%= if lesson.score do %>
                      <span class="<%= @h.score_class(lesson.score) %>">
                        <%= lesson.score %>
                      </span>
                    <% else %>
                      <span style="color: #94a3b8;">-</span>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        <% else %>
          <div class="empty-state">
            <p>Nenhuma aula no periodo.</p>
          </div>
        <% end %>
      </div>

      <!-- BNCC Coverage -->
      <div>
        <h2 class="section-title">Competencias BNCC</h2>
        <%= if length(@bncc_coverage) > 0 do %>
          <%= for item <- @bncc_coverage do %>
            <div class="bncc-item">
              <span class="bncc-code"><%= item.code %></span>
              <span class="bncc-name"><%= @h.truncate(item.name, 35) %></span>
              <span class="bncc-count"><%= item.count %>x</span>
            </div>
          <% end %>
        <% else %>
          <div class="empty-state">
            <p>Nenhuma competencia identificada.</p>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Info Card -->
  <div class="section">
    <div class="info-card">
      <div class="info-title">Sobre este Relatorio</div>
      <div class="info-text">
        Este relatorio apresenta um resumo do desempenho pedagogico do professor durante o periodo de <%= @period %>.
        Os dados incluem metricas de aulas analisadas, score medio, tendencias de performance e cobertura de competencias BNCC.
        Utilize essas informacoes para acompanhamento pedagogico e planejamento de acoes de melhoria.
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <div class="footer-logo">
      <span>H</span>
      <span>Hellen AI</span>
    </div>
    <span><%= @period %> - <%= @teacher.name %></span>
  </div>
</body>
</html>
